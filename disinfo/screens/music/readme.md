

# State updates from HomeAssistant

State message look like this when using Spotify Connect.
{
   "entity_id":"media_player.sonos_beam",
   "old_state":{
      "entity_id":"media_player.sonos_beam",
      "state":"playing",
      "attributes":{
         "group_members":[
            "media_player.office",
            "media_player.sonos_beam",
            "media_player.sonos_black",
            "media_player.sonos_white"
         ],
         "volume_level":0.16,
         "is_volume_muted":false,
         "media_content_id":"x-sonos-vli:RINCON_542A1B556F2001400:2,spotify:9427dbc340633d537bd48bdd5758a143",
         "media_content_type":"music",
         "media_duration":300,
         "media_position":0,
         "media_position_updated_at":"2023-07-26T20:22:05.425276+00:00",
         "media_title":"Your Heart Is As Black As Night",
         "media_artist":"Beth Hart, Joe Bonamassa",
         "media_album_name":"Don't Explain",
         "source":"Spotify Connect",
         "shuffle":false,
         "repeat":"off",
         "queue_size":1,
         "device_class":"speaker",
         "entity_picture":"/api/media_player_proxy/media_player.sonos_beam?token=ce27f6dfe4ad8d9017eccf75cd35e3b16a79aaf691f41ee8e9e0c01490186d1c&cache=bea6c681ee98993f",
         "friendly_name":"Sonos Beam",
         "supported_features":981567
      },
      "last_changed":"2023-07-26T20:19:24.428843+00:00",
      "last_updated":"2023-07-26T20:22:05.428168+00:00",
      "context":{
         "id":"01H69XVAVMHQDB53ES3DVYEZM3",
         "parent_id":"None",
         "user_id":"None"
      }
   },
   "new_state":{
      "entity_id":"media_player.sonos_beam",
      "state":"playing",
      "attributes":{
         "group_members":[
            "media_player.office",
            "media_player.sonos_beam",
            "media_player.sonos_black",
            "media_player.sonos_white"
         ],
         "volume_level":0.16,
         "is_volume_muted":false,
         "media_content_id":"x-sonos-vli:RINCON_542A1B556F2001400:2,spotify:9427dbc340633d537bd48bdd5758a143",
         "media_content_type":"music",
         "media_duration":251,
         "media_position":0,
         "media_position_updated_at":"2023-07-26T20:22:05.425276+00:00",
         "media_title":"For My Friends",
         "media_artist":"Beth Hart, Joe Bonamassa",
         "media_album_name":"Don't Explain",
         "source":"Spotify Connect",
         "shuffle":false,
         "repeat":"off",
         "queue_size":1,
         "device_class":"speaker",
         "entity_picture":"/api/media_player_proxy/media_player.sonos_beam?token=ce27f6dfe4ad8d9017eccf75cd35e3b16a79aaf691f41ee8e9e0c01490186d1c&cache=bea6c681ee98993f",
         "friendly_name":"Sonos Beam",
         "supported_features":981567
      },
      "last_changed":"2023-07-26T20:19:24.428843+00:00",
      "last_updated":"2023-07-26T20:24:40.837984+00:00",
      "context":{
         "id":"01H69Y02M516AX3S4R6096TN4S",
         "parent_id":"None",
         "user_id":"None"
      }
   },
   "_timestamp":"2023-07-26T22:24:40.877648+02:00"
}


Not playing
{
   "entity_id":"media_player.sonos_beam",
   "old_state":{
      "entity_id":"media_player.sonos_beam",
      "state":"playing",
      "attributes":{
         "source_list":[
            "TV"
         ],
         "group_members":[
            "media_player.sonos_beam"
         ],
         "volume_level":0.39,
         "is_volume_muted":false,
         "media_content_id":"x-sonos-vli:RINCON_542A1BD91D0201400:2,spotify:0dc4cb09634866bc961a9ff8ad8d3b46",
         "media_content_type":"music",
         "media_duration":308,
         "media_position":0,
         "media_position_updated_at":"2023-08-19T12:00:10.241959+00:00",
         "media_title":"I Want You",
         "media_artist":"Moloko",
         "media_album_name":"Statues",
         "media_playlist":"Speaker Testing Tracks",
         "source":"Spotify Connect",
         "shuffle":false,
         "repeat":"all",
         "queue_size":1,
         "device_class":"speaker",
         "entity_picture":"/api/media_player_proxy/media_player.sonos_beam?token=ada859be1a9f9b5bf6030fa6d46619820e35915d130b0860feca0631a267f6c3&cache=a4967afb8fce13b8",
         "friendly_name":"Salon",
         "supported_features":4127295
      },
      "last_changed":"2023-08-19T11:09:20.856004+00:00",
      "last_updated":"2023-08-19T12:00:10.292253+00:00",
      "context":{
         "id":"01H86TNHG59J6BKRFNX864Y9RY",
         "parent_id":"01H86TNHG2WQPEB301DQ9GZDTY",
         "user_id":"None"
      }
   },
   "new_state":{
      "entity_id":"media_player.sonos_beam",
      "state":"playing",
      "attributes":{
         "source_list":[
            "TV"
         ],
         "group_members":[
            "media_player.sonos_beam"
         ],
         "volume_level":0.12,
         "is_volume_muted":false,
         "media_content_id":"x-sonos-vli:RINCON_542A1BD91D0201400:2,spotify:0dc4cb09634866bc961a9ff8ad8d3b46",
         "media_content_type":"music",
         "media_duration":308,
         "media_position":0,
         "media_position_updated_at":"2023-08-19T12:00:10.241959+00:00",
         "media_title":"I Want You",
         "media_artist":"Moloko",
         "media_album_name":"Statues",
         "media_playlist":"Speaker Testing Tracks",
         "source":"Spotify Connect",
         "shuffle":false,
         "repeat":"all",
         "queue_size":1,
         "device_class":"speaker",
         "entity_picture":"/api/media_player_proxy/media_player.sonos_beam?token=ada859be1a9f9b5bf6030fa6d46619820e35915d130b0860feca0631a267f6c3&cache=a4967afb8fce13b8",
         "friendly_name":"Salon",
         "supported_features":4127295
      },
      "last_changed":"2023-08-19T11:09:20.856004+00:00",
      "last_updated":"2023-08-19T12:00:10.460811+00:00",
      "context":{
         "id":"01H86TNHG59J6BKRFNX864Y9RY",
         "parent_id":"01H86TNHG2WQPEB301DQ9GZDTY",
         "user_id":"None"
      }
   },
   "_timestamp":"2023-08-19T14:00:10.453628+02:00"
}

Then playing
{
   "entity_id":"media_player.sonos_beam",
   "old_state":{
      "entity_id":"media_player.sonos_beam",
      "state":"playing",
      "attributes":{
         "source_list":[
            "TV"
         ],
         "group_members":[
            "media_player.sonos_beam"
         ],
         "volume_level":0.12,
         "is_volume_muted":false,
         "media_content_id":"x-sonos-vli:RINCON_542A1BD91D0201400:2,spotify:0dc4cb09634866bc961a9ff8ad8d3b46",
         "media_content_type":"music",
         "media_duration":308,
         "media_position":0,
         "media_position_updated_at":"2023-08-19T12:00:10.241959+00:00",
         "media_title":"I Want You",
         "media_artist":"Moloko",
         "media_album_name":"Statues",
         "media_playlist":"Speaker Testing Tracks",
         "source":"Spotify Connect",
         "shuffle":false,
         "repeat":"all",
         "queue_size":1,
         "device_class":"speaker",
         "entity_picture":"/api/media_player_proxy/media_player.sonos_beam?token=ada859be1a9f9b5bf6030fa6d46619820e35915d130b0860feca0631a267f6c3&cache=a4967afb8fce13b8",
         "friendly_name":"Salon",
         "supported_features":4127295
      },
      "last_changed":"2023-08-19T11:09:20.856004+00:00",
      "last_updated":"2023-08-19T12:00:10.460811+00:00",
      "context":{
         "id":"01H86TNHG59J6BKRFNX864Y9RY",
         "parent_id":"01H86TNHG2WQPEB301DQ9GZDTY",
         "user_id":"None"
      }
   },
   "new_state":{
      "entity_id":"media_player.sonos_beam",
      "state":"playing",
      "attributes":{
         "source_list":[
            "TV"
         ],
         "group_members":[
            "media_player.sonos_beam"
         ],
         "volume_level":0.12,
         "is_volume_muted":false,
         "media_content_id":"x-sonos-vli:RINCON_542A1BD91D0201400:2,spotify:0dc4cb09634866bc961a9ff8ad8d3b46",
         "media_content_type":"music",
         "media_duration":308,
         "media_position":99,
         "media_position_updated_at":"2023-08-19T12:01:13.390234+00:00",
         "media_title":"I Want You",
         "media_artist":"Moloko",
         "media_album_name":"Statues",
         "media_playlist":"Speaker Testing Tracks",
         "source":"Spotify Connect",
         "shuffle":false,
         "repeat":"all",
         "queue_size":1,
         "device_class":"speaker",
         "entity_picture":"/api/media_player_proxy/media_player.sonos_beam?token=ada859be1a9f9b5bf6030fa6d46619820e35915d130b0860feca0631a267f6c3&cache=a4967afb8fce13b8",
         "friendly_name":"Salon",
         "supported_features":4127295
      },
      "last_changed":"2023-08-19T11:09:20.856004+00:00",
      "last_updated":"2023-08-19T12:01:13.390943+00:00",
      "context":{
         "id":"01H86TQF5E2PB63R0FSSGDN79R",
         "parent_id":"None",
         "user_id":"None"
      }
   },
   "_timestamp":"2023-08-19T14:01:13.443765+02:00"
}

Airplay source
{
   "entity_id":"media_player.sonos_beam",
   "old_state":{
      "entity_id":"media_player.sonos_beam",
      "state":"playing",
      "attributes":{
         "source_list":[
            "TV"
         ],
         "group_members":[
            "media_player.sonos_beam"
         ],
         "volume_level":0.12,
         "is_volume_muted":false,
         "media_content_id":"x-sonos-vli:RINCON_542A1BD91D0201400:1,airplay:df131dd668544d23b51cca8bf09a2067",
         "media_content_type":"music",
         "media_duration":286,
         "media_position":45,
         "media_position_updated_at":"2023-08-19T12:03:28.435651+00:00",
         "source":"AirPlay",
         "shuffle":false,
         "repeat":"off",
         "queue_size":1,
         "device_class":"speaker",
         "entity_picture":"/api/media_player_proxy/media_player.sonos_beam?token=ada859be1a9f9b5bf6030fa6d46619820e35915d130b0860feca0631a267f6c3&cache=606a6b05368f2fb2",
         "friendly_name":"Salon",
         "supported_features":4127295
      },
      "last_changed":"2023-08-19T12:03:26.363413+00:00",
      "last_updated":"2023-08-19T12:03:28.436297+00:00",
      "context":{
         "id":"01H86TVK1MBVBT0DWKY9D936S0",
         "parent_id":"None",
         "user_id":"None"
      }
   },
   "new_state":{
      "entity_id":"media_player.sonos_beam",
      "state":"playing",
      "attributes":{
         "source_list":[
            "TV"
         ],
         "group_members":[
            "media_player.sonos_beam"
         ],
         "volume_level":0.12,
         "is_volume_muted":false,
         "media_content_id":"x-sonos-vli:RINCON_542A1BD91D0201400:1,airplay:df131dd668544d23b51cca8bf09a2067",
         "media_content_type":"music",
         "media_duration":286,
         "media_position":0,
         "media_position_updated_at":"2023-08-19T12:03:28.461961+00:00",
         "media_title":"\"Si l\\'émission s\\'arrête c\\'est de ma faute\"",
         "media_album_name":"La chronique d'Aymeric Lompret",
         "source":"AirPlay",
         "shuffle":false,
         "repeat":"off",
         "queue_size":1,
         "device_class":"speaker",
         "entity_picture":"/api/media_player_proxy/media_player.sonos_beam?token=ada859be1a9f9b5bf6030fa6d46619820e35915d130b0860feca0631a267f6c3&cache=606a6b05368f2fb2",
         "friendly_name":"Salon",
         "supported_features":4127295
      },
      "last_changed":"2023-08-19T12:03:26.363413+00:00",
      "last_updated":"2023-08-19T12:03:28.462420+00:00",
      "context":{
         "id":"01H86TVK2EV9MJZG1PBSCRV18T",
         "parent_id":"None",
         "user_id":"None"
      }
   },
   "_timestamp":"2023-08-19T14:03:28.461181+02:00"
}

Sonos playing radio
{
   "entity_id":"media_player.sonos_beam",
   "old_state":{
      "entity_id":"media_player.sonos_beam",
      "state":"paused",
      "attributes":{
         "group_members":[
            "media_player.office",
            "media_player.sonos_black",
            "media_player.sonos_beam",
            "media_player.sonos_white"
         ],
         "volume_level":0.12,
         "is_volume_muted":false,
         "media_content_id":"x-sonosapi-stream:tunein%3a7226?sid=303&flags=8232&sn=1",
         "media_content_type":"music",
         "media_title":"Radio Nova",
         "media_channel":"Radio Nova",
         "shuffle":false,
         "repeat":"off",
         "queue_position":1,
         "queue_size":1,
         "device_class":"speaker",
         "entity_picture":"/api/media_player_proxy/media_player.sonos_beam?token=ada859be1a9f9b5bf6030fa6d46619820e35915d130b0860feca0631a267f6c3&cache=178e7ab5b96e9d58",
         "friendly_name":"Salon",
         "supported_features":4127295
      },
      "last_changed":"2023-08-19T12:05:13.168851+00:00",
      "last_updated":"2023-08-19T12:05:13.168851+00:00",
      "context":{
         "id":"01H86TYSAGJJWXS8VDK4Z4K8G5",
         "parent_id":"None",
         "user_id":"None"
      }
   },
   "new_state":{
      "entity_id":"media_player.sonos_beam",
      "state":"paused",
      "attributes":{
         "source_list":[
            "TV"
         ],
         "group_members":[
            "media_player.sonos_beam"
         ],
         "volume_level":0.12,
         "is_volume_muted":false,
         "media_content_id":"hls-radio://https://prod-pre.fns.tunein.com/v1/master/30ead7055f8b8e1f2f04add745f139b184df6925/prod_preroll/preroll0.m3u8?ads.cust_params=partnerId%253dSonosRadio%2526ads_partner_alias%253dce.SonosApp%2526version%253d1%2526premium%253dfalse%2526abtest%253d%2526language%253den%2526stationId%253ds17696%2526is_ondemand%253dfalse%2526genre_id%253dg2757%2526class%253dmusic%2526is_family%253dfalse%2526is_mature%253dfalse%2526country_region_id%253d80%2526station_language%253dfr%2526programId%253dp1032331%2526is_event%253dfalse%2526AffiliateIds%253d39087%25252c40075%2526enableDoublePreroll%253dfalse&ads.stationId=s17696&ads.ads_partner_alias=ce.SonosApp&ads.url=https%3a%2f%2ftunein.com%2fdesc%2fs17696%2f&ads.description_url=https%3a%2f%2ftunein.com%2fdesc%2fs17696%2f&ads.npa=1&ads.gdfp_req=1&ads.bundleId=tunein.com&ads.is_lat=1",
         "media_content_type":"music",
         "media_title":"Radio Nova",
         "media_channel":"Radio Nova",
         "shuffle":false,
         "repeat":"off",
         "queue_position":1,
         "queue_size":2,
         "device_class":"speaker",
         "entity_picture":"/api/media_player_proxy/media_player.sonos_beam?token=ada859be1a9f9b5bf6030fa6d46619820e35915d130b0860feca0631a267f6c3&cache=564374e8e5f47dd2",
         "friendly_name":"Salon",
         "supported_features":4127295
      },
      "last_changed":"2023-08-19T12:05:13.168851+00:00",
      "last_updated":"2023-08-19T12:05:13.261346+00:00",
      "context":{
         "id":"01H86TYSDD2ZW3JMPZGQNTD51J",
         "parent_id":"None",
         "user_id":"None"
      }
   },
   "_timestamp":"2023-08-19T14:05:13.258987+02:00"
}



# Switching from Spotify to TV
{
   "entity_id":"media_player.sonos_beam",
   "old_state":{
      "entity_id":"media_player.sonos_beam",
      "state":"playing",
      "attributes":{
         "group_members":[
            "media_player.sonos_black",
            "media_player.sonos_white",
            "media_player.sonos_beam"
         ],
         "volume_level":0.16,
         "is_volume_muted":false,
         "media_content_id":"x-rincon-mp3radio://https://novazz.ice.infomaniak.ch/novazz-128.mp3",
         "media_content_type":"music",
         "media_title":"Radio Nova",
         "media_channel":"Radio Nova",
         "shuffle":false,
         "repeat":"off",
         "queue_position":2,
         "queue_size":2,
         "device_class":"speaker",
         "entity_picture":"/api/media_player_proxy/media_player.sonos_beam?token=ada859be1a9f9b5bf6030fa6d46619820e35915d130b0860feca0631a267f6c3&cache=977a6f691cd43eef",
         "friendly_name":"Salon",
         "supported_features":4127295
      },
      "last_changed":"2023-08-19T13:04:32.320830+00:00",
      "last_updated":"2023-08-19T15:46:51.536491+00:00",
      "context":{
         "id":"01H877MM0G7GBZ4YQNYJBTZ36Q",
         "parent_id":"None",
         "user_id":"None"
      }
   },
   "new_state":{
      "entity_id":"media_player.sonos_beam",
      "state":"playing",
      "attributes":{
         "source_list":[
            "TV"
         ],
         "group_members":[
            "media_player.sonos_beam"
         ],
         "volume_level":0.16,
         "is_volume_muted":false,
         "media_content_id":"x-sonos-htastream:RINCON_542A1BD91D0201400:spdif",
         "media_content_type":"music",
         "media_title":"TV",
         "source":"TV",
         "shuffle":false,
         "repeat":"off",
         "queue_size":1,
         "device_class":"speaker",
         "friendly_name":"Salon",
         "supported_features":4127295
      },
      "last_changed":"2023-08-19T13:04:32.320830+00:00",
      "last_updated":"2023-08-19T16:10:27.455807+00:00",
      "context":{
         "id":"01H878ZTQZ47ZFN4JWKA37R4VX",
         "parent_id":"None",
         "user_id":"None"
      }
   },
   "_timestamp":"2023-08-19T18:10:27.483801+02:00"
}

--- then, it changes state immediately

{
   "entity_id":"media_player.sonos_beam",
   "old_state":{
      "entity_id":"media_player.sonos_beam",
      "state":"playing",
      "attributes":{
         "source_list":[
            "TV"
         ],
         "group_members":[
            "media_player.sonos_beam"
         ],
         "volume_level":0.16,
         "is_volume_muted":false,
         "media_content_id":"x-sonos-htastream:RINCON_542A1BD91D0201400:spdif",
         "media_content_type":"music",
         "media_title":"TV",
         "source":"TV",
         "shuffle":false,
         "repeat":"off",
         "queue_size":1,
         "device_class":"speaker",
         "friendly_name":"Salon",
         "supported_features":4127295
      },
      "last_changed":"2023-08-19T13:04:32.320830+00:00",
      "last_updated":"2023-08-19T16:10:27.455807+00:00",
      "context":{
         "id":"01H878ZTQZ47ZFN4JWKA37R4VX",
         "parent_id":"None",
         "user_id":"None"
      }
   },
   "new_state":{
      "entity_id":"media_player.sonos_beam",
      "state":"playing",
      "attributes":{
         "source_list":[
            "TV"
         ],
         "group_members":[
            "media_player.sonos_beam"
         ],
         "volume_level":0,
         "is_volume_muted":false,
         "media_content_id":"x-sonos-htastream:RINCON_542A1BD91D0201400:spdif",
         "media_content_type":"music",
         "media_title":"TV",
         "source":"TV",
         "shuffle":false,
         "repeat":"off",
         "queue_size":1,
         "device_class":"speaker",
         "friendly_name":"Salon",
         "supported_features":4127295
      },
      "last_changed":"2023-08-19T13:04:32.320830+00:00",
      "last_updated":"2023-08-19T16:10:27.487425+00:00",
      "context":{
         "id":"01H878ZTRAR9TPFTPPXWKFV0JR",
         "parent_id":"01H878ZTQZ47ZFN4JWKA37R4VX",
         "user_id":"None"
      }
   },
   "_timestamp":"2023-08-19T18:10:27.486968+02:00"
}

--- to new volume (due to an automation)

{
   "entity_id":"media_player.sonos_beam",
   "old_state":{
      "entity_id":"media_player.sonos_beam",
      "state":"playing",
      "attributes":{
         "source_list":[
            "TV"
         ],
         "group_members":[
            "media_player.sonos_beam"
         ],
         "volume_level":0,
         "is_volume_muted":false,
         "media_content_id":"x-sonos-htastream:RINCON_542A1BD91D0201400:spdif",
         "media_content_type":"music",
         "media_title":"TV",
         "source":"TV",
         "shuffle":false,
         "repeat":"off",
         "queue_size":1,
         "device_class":"speaker",
         "friendly_name":"Salon",
         "supported_features":4127295
      },
      "last_changed":"2023-08-19T13:04:32.320830+00:00",
      "last_updated":"2023-08-19T16:10:27.487425+00:00",
      "context":{
         "id":"01H878ZTRAR9TPFTPPXWKFV0JR",
         "parent_id":"01H878ZTQZ47ZFN4JWKA37R4VX",
         "user_id":"None"
      }
   },
   "new_state":{
      "entity_id":"media_player.sonos_beam",
      "state":"playing",
      "attributes":{
         "source_list":[
            "TV"
         ],
         "group_members":[
            "media_player.sonos_beam"
         ],
         "volume_level":0.31,
         "is_volume_muted":false,
         "media_content_id":"x-sonos-htastream:RINCON_542A1BD91D0201400:spdif",
         "media_content_type":"music",
         "media_title":"TV",
         "source":"TV",
         "shuffle":false,
         "repeat":"off",
         "queue_size":1,
         "device_class":"speaker",
         "friendly_name":"Salon",
         "supported_features":4127295
      },
      "last_changed":"2023-08-19T13:04:32.320830+00:00",
      "last_updated":"2023-08-19T16:10:27.695102+00:00",
      "context":{
         "id":"01H878ZTRAR9TPFTPPXWKFV0JR",
         "parent_id":"01H878ZTQZ47ZFN4JWKA37R4VX",
         "user_id":"None"
      }
   },
   "_timestamp":"2023-08-19T18:10:27.663248+02:00"
}


# NO notification when it stops playing on tv.
